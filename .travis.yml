language: bash
os: windows
env:
  - MSBUILD_PATH="C:\Program Files (x86)\Microsoft Visual Studio\2017\BuildTools\MSBuild\15.0\Bin"
install:
  - choco install nuget.commandline
  - nuget restore SAGESharp.sln
script:
  - export PATH="$MSBUILD_PATH:$PATH"
  - MSBuild.exe //p:Configuration=Release SAGESharp.sln
  - packages/NUnit.ConsoleRunner.3.10.0/tools/nunit3-console.exe ./SAGESharp.Tests/bin/Release/SAGESharp.Tests.dll
  - MSBuild.exe //p:Configuration="Release Signed" SAGESharp.sln
  - nuget pack -properties Configuration="Release Signed" SAGESharp/
deploy:
  - provider: releases
    skip_cleanup: true
    api_key: $GITHUB_KEY
    file: SAGESharp.$TRAVIS_TAG.nupkg
    on:
      tags: true
  - provider: script
    skip_cleanup: true
    script:
      - nuget push ./SAGESharp.$TRAVIS_TAG.nupkg -ApiKey $NUGET_ORG_KEY -Source https://api.nuget.org/v3/index.json
    on:
      tags: true
